const baseUrl = (route='') => {
    var domain = location.protocol+'//'+location.hostname+'/'
    if(typeof route != 'undefined'||route!=''){
        return domain+route
    }else{
        return domain
    }
}
const asset = (route='')=> {
    return baseUrl(route)
}
function formatRupiah(angka, prefix = 'Rp.') {
	var returns = new Intl.NumberFormat("id-ID", {
		style: "currency",
		currency: "IDR",
		minimumFractionDigits: 0
	}).format(angka);
	return returns
}
window.mobileCheck = function() {
    let check = false;
    (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
    return check;
};
var firebaseConfig = {
    apiKey: "AIzaSyC1UHyMpCO6W1I_xVbhYG6Rf9u5tvK6cX8",
    authDomain: "app.saraga.id",
    databaseURL: "https://saraga-b6f04.firebaseio.com",
    projectId: "saraga-b6f04",
    storageBucket: "saraga-b6f04.appspot.com",
    messagingSenderId: "389008221591",
    appId: "1:389008221591:web:0bc8845f8fabddaf7d90d2",
    measurementId: "G-6XEBMB0P4T"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
firebase.analytics();
function create_UUID(){
    var dt = new Date().getTime();
    var uuid = 'xxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = (dt + Math.random()*16)%16 | 0;
        dt = Math.floor(dt/16);
        return (c=='x' ? r :(r&0x3|0x8)).toString(16);
    });
    return uuid;
}
function link_copy(){
    var urls = window.location.href
    urls = urls.replace(/\#/gi,'')
    var input = document.createElement('input');
    input.setAttribute('value', urls);
    document.body.appendChild(input);
    input.select();
    var result = document.execCommand('copy');
    document.body.removeChild(input);
    tempAlert("Link Tersalin!",1000);
    return result;
}
function tempAlert(msg,duration=1200)
{
    //  var el = document.createElement("span");
    //  el.setAttribute("class","badge badge-secondary");
    //  el.setAttribute("style","position:fixed; top:70; left: 50%; transform: translate(-50%, 0); padding:10px; text-align:center; background-color: rgb(226,42,42); font-size:large;");
    //  el.innerHTML = msg;
    //   el.parentNode.removeChild(el);
    //  document.body.appendChild(el);
    var el = `<span class="tempAlert badge badge-secondary" style="position:fixed; top:70px; left: 50%; transform: translate(-50%, 0); padding:10px; text-align:center; background-color: rgba(226,42,42,0.75); font-size:large;">${msg}</span>`
    console.log(msg)
     setTimeout(function(){
        $(document).find('.tempAlert').remove()
     },1500);
     $(document).find('body').append(el)
}
(function($){ 
    $.fn.timeout = function(ms, callback)
    {
        var self = this;
        setTimeout(function(){ callback.call(self); }, ms);
        return this;
    }
})(jQuery);
function ToastAlert(title,message= '',status=""){
    let data = {
        title: title,
        message: message,
        status: status,
        timeout: 5000,
        content:'',
        htmlTitle: '',
        htmlMessage: '',
        alertClass: ''
    }
    let _title = '', _message = '', _status=''
    let counter = $('.toast_alert').find('.toast_alert-content').length
    const hide = (elem)=> {
        if(elem.length==0){
            return false
        }
        console.log(elem)
        $('.toast_alert').find(elem).hide().remove()
        counter = $('.toast_alert').find('.toast_alert-content').length
        if(counter==0){
            $('.toast_alert').remove()
        }
        return true
    }
    const _init = ()=>{
        if(typeof title ==='object'){
            message = ''
            status=''
            let _c = title
            data.title = _c.title || ''
            data.message = _c.message || ''
            data.status = _c.status || ''
            data.timeout = _c.timeout || ''
            data.content = _c.content || ''
            data.htmlTitle = _c.htmlTitle || ''
            data.htmlMessage = _c.htmlMessage || ''
            data.alertClass = _c.alertClass || ''
        }
        let valid = true;
        let isString = ['title','message','status','content','htmlTitle','htmlMessage','alertClass']
        for(let x in data){
            let v = data[x]
            if(valid==false){
                break;
            }
            if(x=='timeout'){
                if(v===''){
                    valid=true
                }else if(parseInt(v)===NaN){
                    valid=false
                }
            }
            else if(isString.includes(x)&&typeof v !== 'string'){
                valid=false
            }
        }
        if(!valid){
            return false
        }
        switch (data.status) {
            case 'error':
            case 'danger':
                _status='danger'
                break;
            case 'success':
                _status='success'
                break;
            case 'warning':
                _status='warning'
                break;
        
            default:
                _status=''
                break;
        }
        console.log(data)
        _title = data.htmlTitle==''?(data.title!=''?`<strong class="mr-2">${data.title}</strong>`:''):data.htmlTitle
        _message = data.htmlMessage==''?(data.message!=''?`<span>${data.message}</span>`:''):data.htmlMessage
        let elem = `<div class="toast_alert">
                    </div>`
        if($(document).find('.toast_alert').length==0){
            $('body').append(elem)
        }
        if(counter>=4){
            $('.toast_alert').find('.toast_alert-content').remove()
            counter = 0;
        }
        let _messages = `<div class="toast_alert-content ${_status} ${data.alertClass}" data-index="${counter}">`
        if(data.content==''){
            _messages += _title!=''?_title:''
            _messages += _message
        }else{
            _messages += data.content
        }
        _messages +=`</div>`
        if(data.timeout!=''){
            data.timeout = parseInt(data.timeout)
            $(_messages).appendTo('.toast_alert').delay(data.timeout).queue(function(){
                this.remove()
                counter = $('.toast_alert').find('.toast_alert-content').length
                if(counter==0){
                    $('.toast_alert').remove()
                }
            })
        }else{
            $(_messages).appendTo('.toast_alert')
        }
        $(document).on('click','.toast_alert-content',function(){
            // let index = $(this).data('index')
            $(this).hide().remove()
            counter = $('.toast_alert').find('.toast_alert-content').length
            if(counter==0){
                $('.toast_alert').remove()
            }
        })
        return data;
    }
    _init()
    // console.log({title,message,status})
    return {_init,hide}
}
function number_format(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}
function create_widget(index, array) {
    var html = "<div class='widget-header'>";
    html += create_list(index, array)
    html += "</div>";
    return html;
}
function parseDateString (dateString) {
    var matchers = [];
    matchers.push(/^[0-9]*$/.source);
    matchers.push(/([0-9]{1,2}\/){2}[0-9]{4}( [0-9]{1,2}(:[0-9]{2}){2})?/.source);
    matchers.push(/[0-9]{4}([\/\-][0-9]{1,2}){2}( [0-9]{1,2}(:[0-9]{2}){2})?/.source);
    matchers = new RegExp(matchers.join("|"));
    if (dateString instanceof Date) {
        return dateString;
    }
    if (String(dateString).match(matchers)) {
        if (String(dateString).match(/^[0-9]*$/)) {
            dateString = Number(dateString);
        }
        if (String(dateString).match(/\-/)) {
            dateString = String(dateString).replace(/\-/g, "/");
        }
        return new Date(dateString);
    } else {
        throw new Error("Couldn't cast `" + dateString + "` to a date object.");
    }
}
function create_list(index, array) {
    var title = ""
    var address = ""
    if (array === "spots") {
        title = spots_result[index].name;
        address = spots_result[index].address;
    } else {
        title = locations_result[index];
    }

    var html = `<a href="#" data-dismiss="modal" onclick='list_clicked("${index}", "${array}")'>`;
    html += "<div class='d-flex'>";
    html += "<div class='d-flex align-items-center'>";
    if (array === "spots") {
        html += `<span><img class="icon" src="${asset('images/sports')}/badminton.svg"></img></span>`;
    } else {
        html += `<span><img class="icon" src="${asset('images/city.svg')}"></img></span>`;
    }
    html += "</div>";
    html += "<div class='pl-3'>";
    html += "<p class='lead' style='color: black; font-weight: bold; margin-bottom: 0px; font-size: 1rem;'>" + title + "</p>";
    if (array === "spots") {
        html += "<p class='text-muted'>" + address + "</p>";
    }
    html += "</div>";
    html += "</div></a>";
    return html;
}
function doneTyping(url='') {
    url = url||baseUrl('filter/recommendation')
    var token = $('meta[name="csrf-token"]').val()
    $.get(url, {
            _token: `${token}`,
            keyword: $("#searchInput").val(),
            sport_id: $("#select-category").val()
        },
        function (data, status) {
            var json = JSON.parse(data);
            spots_result = [...new Set(json.spots)];
            locations_result = [...new Set(json.cities)];
            // Fill spots list
            var spots_html = "<p class='lead'>There is no result for <b>" + $("#searchInput").val() + "</b></p>";
            if (spots_result.length > 0) {
                spots_html = "";
                for (var i = 0; i < spots_result.length - 1; i++) {
                    spots_html += create_widget(i, "spots")
                }
                i = spots_result.length - 1;
                spots_html += create_list(i, "spots");
            };
            $("#spots_list").html(spots_html);

            // Fill city list
            var location_html = "<p class='lead'>There is no result for <b>" + $("#searchInput").val() + "</b></p>";
            if (spots_result.length > 0) {
                location_html = "";
                for (var i = 0; i < locations_result.length - 1; i++) {
                    location_html += create_widget(i, "locations")
                }
                i = locations_result.length - 1;
                location_html += create_list(i, "locations");
            };
            $("#location_list").html(location_html);
        });
}
function list_clicked(index, array){
    var title = "";
    if(array === "spots"){
      title = spots_result[index].name;
    }
    else{
      title = locations_result[index];
    }
    // $("#keyword").val(title);
    $('.keyword').each(function() {
      $(this).val(title);
      var that = this;
      setTimeout(function(){ that.selectionStart = that.selectionEnd = 10000; }, 0);
    });
}
function getTimeslots(selected_date) {
    lastDateSelect = selected_date;
    let today = $(".list-available_dates").data("today");
    let currentTime = moment().format("HH:mm:ss");
    var height = $("#field-timeslots").height();
    var url = $("#field-timeslots").data("url");
    let ob_selected_date = moment(selected_date);
    let str_selected_date = ob_selected_date.format("dddd, DD MMM YY");
    return new Promise((resolve,reject)=>{
      $.ajax({
        url: url,
        type: "POST",
        data: {
          selected_date: selected_date,
        },
        error: function (err) {
          var elem = `<div class="col-lg-12 my-4 align-self-center">
                                <p class="my-auto text-center">Jam Bermain Tidak Tersedia untuk Tanggal Ini<br><small>Silahkan Pilih Tanggal yang Lain</small></p>
                                </div>`;
          $("#field-timeslots")
            .html(elem)
            .css("height", height)
            .css("min-height", "");
          reject(err)
        },
      }).done(function (res) {
        if (res.view) {
          $("#field-timeslots")
            .attr("selected_date", selected_date)
            .html(res.view);
        } else {
          $("#field-timeslots").attr("selected_date", selected_date).html(res);
        }
        
        if (res.form) {
          $(".form_detail", document).html(res.form);
          $(".form_detail", document).find("#input-date").val(selected_date);
          $(".form_detail", document).find("#input-date-next").val(selected_date);
        }
        if (selected_date == today) {
          $(".time-button").each(function (i, obj) {
            if (currentTime >= $(obj).attr("time")) {
              $(obj).removeClass("active");
              $(obj).addClass("disabled");
            }
          });
        }
        fill_duration();
        check_scroll();
        console.log({selected_date,res})
        $(document).find('#field-timeslots').promise().done(()=>{
          setTimeout(() => {
            $(document).find(".txt-selected_date").text(`[ ${str_selected_date} ]`);
            $(document).find(`.container-timeslots .loading-timeslot[data-date="${selected_date}"]`).fadeOut();
          }, 350);
        });
        resolve({date:selected_date,res});
        
      });
    })
}
function FlatPickr(){
    let max_book_date = $('#max_book_date').val();
    let date_flag=false;
    let lastDateSelect = '';
    let selectedTimes = [];
    let flatpickr = $(".flatpickr").flatpickr({
        altFormat: "Y-m-d",
        dateFormat: "Y-m-d",
        minDate: "today",
        maxDate: new Date().fp_incr(max_book_date),
        disableMobile: "true",
        onChange: async function (selectedDates, dateStr, instance) {
            lastDateSelect = dateStr;
            $('.container-timeslots .loading-timeslot').attr('data-date',lastDateSelect).fadeIn();
            try {
                $('.flatpickr').addClass('active')
                $('.date-button').addClass('disabled').prop('disabled',true)
                let {date,res} = await getTimeslots(lastDateSelect)
                $("#input-date").val(date);
                $("#input-date-next").val(date);
                $(".date-button").removeClass("disabled").prop('disabled',false);
                // $(".flatpickr").removeClass("disabled").prop('disabled',false);
                console.log({date,res})
            } catch (error) {
                console.error(error)
            }
        },
        onClose: function(selectedDates, dateStr, instance){
          if(typeof dateStr == 'undefined'){
            $(document).find('#button-date-booking').removeClass('active');
          }
          date_flag=false;
        }
    });
    $(document).on('click','#button-date-booking',function () {
        if (date_flag == false) {
            flatpickr.open();
            date_flag = true;
        } else {
            flatpickr.close();
            date_flag = false;
        }
    });
    return flatpickr
}
function socialButton(){
    return $(document).on('click', '.sharing', async function () {
        var data = $(this).data()
        var text = `Lihat Lapangan ${data.venue} di Saraga Indonesia`
        var urls = window.location.href
        var check = urls.match(/\#|\?/)
        urls = check ? urls.split(/\#|\?/)[0] : urls
        console.log(urls)
        if (navigator.share) {
            var shared = {
                title: data.venue,
                text: text,
                url: urls
            }
            try {
                await navigator.share(shared)
            } catch (error) {
                console.log(error)
            }
        } else {
            $("#social-share").jsSocials({
                text: text,
                url: urls,
                showLabel: false,
                showCount: false,
                shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp"]
            });
            $('#mdl-share').modal('show')
        }
    })
}
function fill_duration(){
    var duration = 0;
    var timebutton = $('.time-button.active')
    if(timebutton.length==0){
        $('.btn-submit-booking').prop('disabled',true)
    }else{
        $('.btn-submit-booking').prop('disabled',false)
    }
    var selectedTimes = $.map(timebutton, function (item) {
        var _duration = $(item).data('duration')
        duration += _duration;
        return $(item).attr('ts')
    })

    $("#duration").html(duration + " Jam");
    $("#input-duration").val((duration));
    $("#input-time").val(JSON.stringify(selectedTimes));
}
function selectTime(){
    let selectedHour = [];
    return $(document).on('click','.time-button:not(.disabled)',function(){
        let max_booking_hour = $(document).find('#max_booking_hour').val() || 0;
        console.log({max_booking_hour});
        if(max_booking_hour!=0){
            if(max_booking_hour==1){
                // $(document).find('.time-button').not(this).removeClass('active')
                let fik = selectedHour[0]
                selectedHour.splice(0,1)
                $(fik).removeClass('active')
            }
            if(selectedHour.length>=max_booking_hour){
                let fik = selectedHour[0]
                selectedHour.splice(0,1)
                $(fik).removeClass('active')
            }
        }
        if ($(this).hasClass("active")) {
            $(this).removeClass("active");
        } else {
            selectedHour.push(this)
            $(this).addClass("active");
        }
        fill_duration();
    })
}
function autofill() {
    let _date = moment();
    let today = $(".list-available_dates").data("today");
    let _nOH = _date.clone().add(1,'hours');
    let nextOneHour = _nOH.clone().format('YYYY-MM-DD HH:mm:ss');
    $(document).on("click", "#button-date-booking", function () {
        $(".date-button").removeClass("active");
        $(document).find(`.flatpickr`).addClass("active");
    });
    $(document).on("click", ".date-button:not(.disabled)", async function () {
        if ($(this).hasClass("disabled")) {
            return false;
        }

        var selected_date = $(this).attr("value");
        $(".flatpickr").removeClass("active").addClass('disabled').prop('disabled', true);
        $(".date-button").removeClass("active").not(this).addClass('disabled').prop('disabled', true);
        $(`.date-button[value="${selected_date}"]`).addClass("active");

        if (selected_date) {
            $('.container-timeslots .loading-timeslot').attr('data-date', selected_date).fadeIn();
            try {
                let { date, res } = await getTimeslots(selected_date)
                $("#input-date").val(date);
                $("#input-date-next").val(date);
                $(".date-button").removeClass("disabled").prop('disabled', false);
                $(".flatpickr").removeClass("disabled").prop('disabled', false);
                console.log({ date, res })
            } catch (error) {
                console.error(error)
            }
        } else {
            if ($(this).attr("value") == today) {
                $(".time-button").each(function (i, obj) {
                    if (nextOneHour >= $(obj).attr("time")) {
                        $(obj).removeClass("active");
                        $(obj).addClass("disabled");
                    }
                });
            }
            fill_duration();
        }
    });
    if ($(document).find("#session_input-date").length != 0) {
        let session_data = $("#session_input-date").val();
        if (session_data == "" || session_data <= today) {
            $(document).find(`.date-button[value="${today}"]`).trigger("click");
        } else if (session_data.length != 0) {
            $(document)
                .find(`.date-button[value="${session_data}"]`)
                .trigger("click");
        }
    }
    return true;
}
function isScrolledIntoView(elem) {
    if ($(elem).length == 0) {
      return false;
    }
    let target = $(elem);
    let targetTop = target.offset().top;
    let container = $("main#contents > section");
    let containerTop = container.offset().top;
    let containerBottom = containerTop + container.height();
    let result = targetTop >= containerTop && targetTop < containerBottom;
    // console.log(elem,{
    //     target,
    //     targetTop,
    //     container,
    //     containerTop,
    //     containerBottom,
    //     result
    // })
  
    return result;
}
function check_scroll() {
    let action = $(".action-booking");
    let target = action.attr("href");
    let checkscroll = isScrolledIntoView("#total_durations");
    let showTimeslot = isScrolledIntoView("#field-timeslots");
    console.log({checkscroll,showTimeslot})
    // Check active timeslot duration
    let actionNext = $(".action-next");
    var timeslotDuration = $("#input-duration").val();
    $("#duration-next").html(timeslotDuration + " Jam");

    target = $(target);
    if (checkscroll) {
        action.addClass("d-none");
        actionNext.addClass("d-none");
        target.css("margin-bottom", "auto");
        $(".btn-submit-booking").removeClass("opacity-0");
    } else {
        if (timeslotDuration > 0) {
            action.addClass("d-none");
            actionNext.removeClass("d-none");
        } else {
            action.removeClass("d-none");
            actionNext.addClass("d-none");
            target.css("margin-bottom", "5rem !important");
            $(".btn-submit-booking").addClass("opacity-0");
        }
    }
    if (showTimeslot && $(document).find('.loading-timeslot:visible').length == 0 && $(document).find("#field-timeslots").children().length == 0) {
        console.log('load autofill')
        autofill();
    }
    if (!checkscroll && !showTimeslot) {
        action.removeClass("d-none");
        actionNext.addClass("d-none");
        target.css("margin-bottom", "5rem !important");
        $(".btn-submit-booking").addClass("opacity-0");
    }
    return false;
}
let xTimer = [],bTimer=[]
const zeroPad = (num, places) => String(num).padStart(places, "0");
const paymentTime = (elem) => {
    let time = $(elem).attr('time');
    var countDownDate = moment(time);
    // var countDownDate = new Date(parseDateString(time)).getTime();
    // var countDownDate = new Date(time).getTime();
    var now = moment()
    var distance = countDownDate.clone().diff(now) || 0;
    console.log({distance})
    if (distance > 0) {
        console.log({ payment_time: "RUNNING" })
        return setInterval(() => {
            // Get today's date and time
            now = moment();

            // Find the distance between now and the count down date
            distance = countDownDate.clone().diff(now) || 0;
            // Time calculations for hours, minutes and seconds
            var days = Math.floor(distance / (1000 * 60 * 60 * 24));
            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Display the result in the element with id="demo"
            // $(elem).html((hours+days*24) + "h " + minutes + "m " + seconds + "s ");
            $(elem).children('hour').html(zeroPad(hours + days * 24, 2));
            $(elem).children('minute').html(zeroPad(minutes, 2));
            $(elem).children('second').html(zeroPad(seconds, 2));

            // If the count down is finished, write some text 
            if (distance < 0) {
                $(document).find('#continue_payments').hide();
                $(document).find('#contact_us').css('margin-bottom', 0);
                $(elem).parents('#payment-times').addClass('bg-danger')
                $(elem).parents('.payment-timer').html("Waktu Habis").addClass('font-weight-bold text-white text-centert');
                $(elem).parent(".card-footer").css("background-color", "red");
            }
        }, 1000);
    } else {
        console.log({ payment_time: "EXPIRED" })
        $(document).find('#continue_payments').hide();
        $(document).find('#contact_us').css('margin-bottom', 0);
        $(elem).parents('#payment-times').addClass('bg-danger')
        $(elem).parents('.payment-timer').html("Waktu Habis").addClass('font-weight-bold text-white text-centert');
        $(elem).parent(".card-footer").css("background-color", "red");
        return true;
    }
    // var countDownDate = Date.parse();
    // console.log('timer running',$(elem).attr('id'));
}
function runTimer(){
    $(document).find('.timers').each(function(k,el){
        xTimer[k] = paymentTime(el)
        return true
    })
}
$(function(){
    moment.tz.setDefault('Asia/Jakarta')
    $('[data-toggle="tooltip"]').tooltip()
    $('[data-toggle="popover"]').popover({trigger: 'focus'})
    $(document).on('hide.bs.modal','#modal-verify-otp',function(){
        $('button.verify-otp').text('Submit').prop('disabled',false)
    })
    $(document).on('click','button.verify-otp',function(e){
        e.preventDefault()
        var _this = this
        var form = $(this).parents('form')
        var path = window.location.pathname.split('/')[1];
        $(`form[with-otp="true"]`).validate({
            errorClass:'error is-invalid',
            errorElement:'small'
        })
        $(`input[type="email"]`).each(function(){
            $(this).rules('add',{required:true,email:true,})
        })
        // cek validasi unique email backend //
        // cek validasi unique email backend //
        if($(form).valid()){
            var formData = $(form).serialize()
            $.ajax({
                type:'POST',
                url:baseUrl(`${path}/validation_input`),
                data: formData,
                beforeSend:function(){
                    $(_this).text('Please Wait').prop('disabled',true)
                },
                success:function(result){
                    $.get(baseUrl('profile/do_update'),function(res){
                        console.log(res)
                        $('#modal-verify-otp').modal('show')
                    })
                },
                error:function(xhr, status, error) {
                    $(_this).text('Simpan').prop('disabled',false)
                    var err = JSON.parse(xhr.responseText)
                    console.log(err)
                    err = err.msg
                    var htmls = ``
                    for(var e in err){
                        console.log(err[e])
                        htmls += `<div class="alert alert-danger">
                            <strong>${err[e]}</strong>
                        </div>\n`
                    }
                    $('.el-error').html(htmls)
                }
            })
        }
        // console.log('Form is Valid? ',$(form).valid())
        console.log('submit with otp validation pressed')
    })
    if($('#message-success').is(':visible')){
        setTimeout(() => {
            $('#message-success').slideUp(1000,function(){
                $('#message-success').remove()
            })
            // $('.alert').alert('close')
        }, 2500);
    }
    if($('#searchInput').length>0){
        var typingTimer;                //timer identifier
        var doneTypingInterval = 1000;  //time in ms, 5 second for example

        //on keyup, start the countdown
        $(document).on('keyup','#searchInput', function() {
            clearTimeout(typingTimer);
            typingTimer = setTimeout(doneTyping(), doneTypingInterval);
        });

        //on keydown, clear the countdown 
        $(document).on('keydown','#searchInput', function() {
            clearTimeout(typingTimer);
        });
    }
    $(document).on('click',`[id*="card-"]`,function(){
        var data = $(this).data()
        console.log(data)
        window.location.href = data.action
    })
    if($(document).find('.timers').length>0){
        runTimer()
    }
    $(document).on('click','#reveal-pass,.reveal-pass',function(){
        let parents = $(this).parents('.input-group')
        let input = $(this).data('target')
        console.log({parents,input})
        if($(this).hasClass('revealed')){
            $(input).prop('type','password')
            $(this).removeClass('revealed')
        }else{
            $(this).addClass('revealed')
            $(input).prop('type','text')
        }
    })
    if($('#active-tab').length>0){
        console.log('found')
        $(document).find('#active-tab').trigger('click')
    }
    
    
    const bookingTime = (elem) => {
        let time = $(elem).attr('time');
        var countDownDate = moment(time);
        var now = moment()
        var distance = countDownDate.clone().diff(now) || 0;
        var source_venue_url = $(document).find('.source_venue_url').val()
        if(distance>0){
            console.log({payment_time: "RUNNING"})
            return setInterval(() => {
                // Get today's date and time
                now = moment()
        
                // Find the distance between now and the count down date
                distance = countDownDate.clone().diff(now) || 0;
        
                // Time calculations for hours, minutes and seconds
                var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
                // Display the result in the element with id="demo"
                // $(elem).html((hours+days*24) + "h " + minutes + "m " + seconds + "s ");
                $(elem).children('hour').html(zeroPad(hours+days*24,2));
                $(elem).children('minute').html(zeroPad(minutes,2));
                $(elem).children('second').html(zeroPad(seconds,2));
        
                // If the count down is finished, write some text 
                if (distance < 0) {
                  $(document).find('#continue_payments').hide();
                  $(document).find('#contact_us').css('margin-bottom',0);
                  $(elem).parents('#booking-times').addClass('bg-danger')
                  $(elem).parents('.booking-timer').html("WAKTU PEMESANAN HABIS").addClass('font-weight-bold text-white');
                  $(elem).parent( ".card-footer" ).css( "background-color", "red" );
                  setTimeout(() => {
                      window.location.href = source_venue_url
                  }, 2000);
                }
            }, 1000);
        }else{
            console.log({payment_time: "EXPIRED"})
            $(document).find('#continue_payments').hide();
            $(document).find('#contact_us').css('margin-bottom',0);
            $(elem).parents('#booking-times').addClass('bg-danger')
            $(elem).parents('.booking-timer').html("WAKTU PEMESANAN HABIS").addClass('font-weight-bold text-white');
            $(elem).parent( ".card-footer" ).css( "background-color", "red" );
            // setTimeout(() => {
            //     window.location.href = source_venue_url
            // }, 2000);
            return true;
        }
        // var countDownDate = Date.parse();
        // console.log('timer running',$(elem).attr('id'));
    }
    
    $('.booking-timers').each(function(k,el){
        bTimer[k] = bookingTime(el)
        return true
    })
    $(document).on('click','.btn-open_addons',function(){
        let form_id = $(this).data('form')
        let sourceForm = $(document).find(form_id)
        let inputs = $(sourceForm).find(':input:not(:button)').clone()
        console.log({inputs});
        $(document).find('form.open_addons').append(inputs)
        $(document).find('form.open_addons').trigger('submit');
    })
})

function togglePasswordVisibility(passwordElementId = "password", iconId = "eyeIcon") {
    var passwordInput = document.getElementById(passwordElementId);
    var eyeIcon = document.getElementById(iconId);

    if (passwordInput.type === "password") {
        passwordInput.type = "text";
        eyeIcon.classList.add("show-password");
        eyeIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" height="14" viewBox="0 0 640 512"><path fill="#7E8494" d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zm151 118.3C226 97.7 269.5 80 320 80c65.2 0 118.8 29.6 159.9 67.7C518.4 183.5 545 226 558.6 256c-12.6 28-36.6 66.8-70.9 100.9l-53.8-42.2c9.1-17.6 14.2-37.5 14.2-58.7c0-70.7-57.3-128-128-128c-32.2 0-61.7 11.9-84.2 31.5l-46.1-36.1zM394.9 284.2l-81.5-63.9c4.2-8.5 6.6-18.2 6.6-28.3c0-5.5-.7-10.9-2-16c.7 0 1.3 0 2 0c44.2 0 80 35.8 80 80c0 9.9-1.8 19.4-5.1 28.2zm51.3 163.3l-41.9-33C378.8 425.4 350.7 432 320 432c-65.2 0-118.8-29.6-159.9-67.7C121.6 328.5 95 286 81.4 256c8.3-18.4 21.5-41.5 39.4-64.8L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5zm-88-69.3L302 334c-23.5-5.4-43.1-21.2-53.7-42.3l-56.1-44.2c-.2 2.8-.3 5.6-.3 8.5c0 70.7 57.3 128 128 128c13.3 0 26.1-2 38.2-5.8z"/></svg>';
    } else {
        passwordInput.type = "password";
        eyeIcon.classList.remove("show-password");
        eyeIcon.innerHTML = '<svg height="14" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="#7E8494" d="M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z" /></svg>';
    }
}

function toggleRePasswordVisibility() {
    var passwordInput = document.getElementById("repassword");
    var eyeIcon = document.getElementById("eyeIconRe");

    if (passwordInput.type === "password") {
        passwordInput.type = "text";
        eyeIcon.classList.add("show-password");
        eyeIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" height="14" viewBox="0 0 640 512"><path fill="#7E8494" d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zm151 118.3C226 97.7 269.5 80 320 80c65.2 0 118.8 29.6 159.9 67.7C518.4 183.5 545 226 558.6 256c-12.6 28-36.6 66.8-70.9 100.9l-53.8-42.2c9.1-17.6 14.2-37.5 14.2-58.7c0-70.7-57.3-128-128-128c-32.2 0-61.7 11.9-84.2 31.5l-46.1-36.1zM394.9 284.2l-81.5-63.9c4.2-8.5 6.6-18.2 6.6-28.3c0-5.5-.7-10.9-2-16c.7 0 1.3 0 2 0c44.2 0 80 35.8 80 80c0 9.9-1.8 19.4-5.1 28.2zm51.3 163.3l-41.9-33C378.8 425.4 350.7 432 320 432c-65.2 0-118.8-29.6-159.9-67.7C121.6 328.5 95 286 81.4 256c8.3-18.4 21.5-41.5 39.4-64.8L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5zm-88-69.3L302 334c-23.5-5.4-43.1-21.2-53.7-42.3l-56.1-44.2c-.2 2.8-.3 5.6-.3 8.5c0 70.7 57.3 128 128 128c13.3 0 26.1-2 38.2-5.8z"/></svg>';
    } else {
        passwordInput.type = "password";
        eyeIcon.classList.remove("show-password");
        eyeIcon.innerHTML = '<svg height="14" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="#7E8494" d="M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z" /></svg>';
    }
}