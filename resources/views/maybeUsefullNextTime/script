<script>
        document.addEventListener('DOMContentLoaded', function () {
            const totalHoursInput = document.getElementById('total_hours');
            const weeklyHoursSpan = document.getElementById('weekly_hours');
            const checkboxes = document.querySelectorAll('.day-checkbox');
            let maxWeeklyHours = 0;

            // Fungsi untuk menghitung jam mingguan berdasarkan total jam bulanan
            function calculateWeeklyHours() {
                const totalHours = parseFloat(totalHoursInput.value) || 0;
                maxWeeklyHours = totalHours / 4; // 4 minggu per bulan
                weeklyHoursSpan.textContent = maxWeeklyHours.toFixed(2);
                
                // Reset pesan error
                hapusSemuaPesanError();
                updateAllTimeConstraints();
            }

            // Fungsi untuk menghitung total jam mingguan saat ini
            function getCurrentWeeklyHours() {
                let totalMinutes = 0;

                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const day = checkbox.value;
                        const timeRangeDiv = checkbox.closest('.form-check').querySelector('.time-range');
                        const startInput = timeRangeDiv.querySelector('input[name$="[start]"]');
                        const endInput = timeRangeDiv.querySelector('input[name$="[end]"]');

                        const start = startInput.value;
                        const end = endInput.value;

                        if (start && end) {
                            const [startHour] = start.split(':').map(Number);
                            const [endHour] = end.split(':').map(Number);

                            if (endHour > startHour) {
                                totalMinutes += (endHour - startHour) * 60;
                            }
                        }
                    }
                });

                return totalMinutes / 60;
            }

            // Fungsi untuk menampilkan pesan error
            function showErrorMessage(element, message) {
                // Hapus error message sebelumnya
                hapusPesanError(element);
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'text-danger error-message';
                errorDiv.textContent = message;
                errorDiv.style.fontSize = '0.875em';
                element.parentNode.appendChild(errorDiv);
            }

            // Fungsi untuk menghapus pesan error
            function hapusPesanError(element) {
                const existingError = element.parentNode.querySelector('.error-message');
                if (existingError) {
                    existingError.remove();
                }
            }

            // Fungsi untuk menghapus semua pesan error
            function hapusSemuaPesanError() {
                document.querySelectorAll('.error-message').forEach(el => el.remove());
            }

            // Fungsi untuk memperbarui batasan waktu untuk semua input
            function updateAllTimeConstraints() {
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const timeRangeDiv = checkbox.closest('.form-check').querySelector('.time-range');
                        const startInput = timeRangeDiv.querySelector('input[name$="[start]"]');
                        const endInput = timeRangeDiv.querySelector('input[name$="[end]"]');
                        
                        if (startInput && endInput) {
                            updateEndTimeConstraint(startInput, endInput);
                        }
                    }
                });
            }

            // Fungsi untuk memperbarui batasan waktu selesai
            function updateEndTimeConstraint(startInput, endInput) {
                const start = startInput.value;
                if (start && maxWeeklyHours > 0) {
                    const [startHour] = start.split(':').map(Number);
                    const maxEndHour = Math.min(23, startHour + Math.floor(maxWeeklyHours));
                    
                    endInput.min = start;
                    endInput.max = `${String(maxEndHour).padStart(2, '0')}:00`;
                }
            }

            // Fungsi untuk memvalidasi apakah total jam tidak melebihi batas
            function validateWeeklyHours() {
                const currentHours = getCurrentWeeklyHours();
                if (currentHours > maxWeeklyHours) {
                    return false;
                }
                return true;
            }

            // Event listener untuk total jam bulanan
            totalHoursInput.addEventListener('input', calculateWeeklyHours);

            // Setup event listener untuk setiap checkbox hari
            checkboxes.forEach(checkbox => {
                const day = checkbox.value;
                const timeRangeDiv = checkbox.closest('.form-check').querySelector('.time-range');
                const startInput = timeRangeDiv ? timeRangeDiv.querySelector('input[name$="[start]"]') : null;
                const endInput = timeRangeDiv ? timeRangeDiv.querySelector('input[name$="[end]"]') : null;

                // Toggle waktu input saat checkbox di klik
                checkbox.addEventListener('change', function () {
                    if (timeRangeDiv) {
                        timeRangeDiv.style.display = this.checked ? 'block' : 'none';
                        if (!this.checked) {
                            if (startInput) {
                                startInput.value = '';
                                hapusPesanError(startInput);
                            }
                            if (endInput) {
                                endInput.value = '';
                                hapusPesanError(endInput);
                            }
                        }
                    }
                });

                // Batasi waktu selesai berdasarkan waktu mulai dan batas mingguan
                if (startInput) {
                    startInput.addEventListener('change', function () {
                        if (endInput) {
                            updateEndTimeConstraint(this, endInput);
                            hapusPesanError(this);
                        }
                    });
                }

                // Validasi saat waktu selesai berubah
                if (endInput) {
                    endInput.addEventListener('change', function() {
                        const startInput = this.closest('.time-range').querySelector('input[name$="[start]"]');
                        const start = startInput.value;
                        const end = this.value;
                        
                        if (start && end) {
                            const [startHour] = start.split(':').map(Number);
                            const [endHour] = end.split(':').map(Number);
                            
                            if (endHour <= startHour) {
                                showErrorMessage(this, 'Waktu selesai harus lebih besar dari waktu mulai');
                                return;
                            }
                            
                            // Hitung jam untuk sesi ini
                            const sessionHours = endHour - startHour;
                            
                            // Hitung total jam mingguan tanpa sesi ini
                            const currentHours = getCurrentWeeklyHours();
                            const hoursWithoutThisSession = currentHours - sessionHours;
                            
                            // Hitung sisa jam yang bisa digunakan
                            const remainingHours = maxWeeklyHours - hoursWithoutThisSession;
                            
                            if (sessionHours > remainingHours) {
                                showErrorMessage(this, `Waktu sewa anda melebihi batas maksimal mingguan`);
                            } else {
                                hapusPesanError(this);
                            }
                            
                        }
                    });
                }
            });

            // Inisialisasi batasan waktu awal
            document.querySelectorAll('input[type="time"]').forEach(input => {
                input.min = '07:00';
                input.max = '23:00';
            });
        });
</script>

<script>
        document.addEventListener('DOMContentLoaded', function () {
            // === VARIABEL GLOBAL ===
            const rateMember = 20000;
            const ratePerHour = 25000;
            let maxWeeklyHours = 0;
            

            // === FUNGSI UTAMA ===
            
            // Toggle booking type
            function toggleBookingType() {
                const type = document.getElementById('booking_type')?.value;
                const regular = document.getElementById('regular_booking');
                const member = document.getElementById('member_booking');
                
                if (type === 'member') {
                    if (regular) regular.style.display = 'none';
                    if (member) member.style.display = 'block';
                } else {
                    if (regular) regular.style.display = 'block';
                    if (member) member.style.display = 'none';
                }
            }

            // Hitung waktu selesai
            function calculateEndTime() {
                const startTime = document.getElementById('start_time')?.value;
                const duration = parseInt(document.getElementById('duration')?.value);
                const endTimeInput = document.getElementById('end_time');

                if (!startTime || !duration || !endTimeInput) return;

                const [hours] = startTime.split(':');
                let endHour = parseInt(hours) + duration;
                
                // Kurangi 1 menit untuk menghindari tabrakan jadwal
                endHour--;
                if (endHour > 22) endHour = 22;
                
                endTimeInput.value = `${endHour.toString().padStart(2, '0')}:59`;
            }

            // Update opsi durasi
            function updateDurationOptions() {
                const startTime = document.getElementById('start_time')?.value;
                const durationSelect = document.getElementById('duration');

                if (!startTime || !durationSelect) return;

                const [hours] = startTime.split(':');
                const startHour = parseInt(hours);
                const maxDuration = 23 - startHour;
                
                // Disable opsi yang melebihi batas
                Array.from(durationSelect.options).forEach(option => {
                    const duration = parseInt(option.value);
                    option.disabled = duration > maxDuration;
                });
            }

            // Hitung harga reguler
            function calculateTotalPrice() {
                const duration = parseInt(document.getElementById('duration')?.value) || 0;
                const amountInput = document.getElementById('amount_paid');
                
                if (duration > 0 && amountInput) {
                    const totalPrice = duration * ratePerHour;
                    amountInput.value = `Rp ${totalPrice.toLocaleString('id-ID')}`;
                }
            }

            // Hitung harga member
            function calculateMemberPrice() {
                const totalHours = parseFloat(document.getElementById('total_hours')?.value) || 0;
                const amountInput = document.getElementById('amount_paid_member');
                
                if (amountInput) {
                    const totalPrice = totalHours * rateMember;
                    amountInput.value = `Rp ${totalPrice.toLocaleString('id-ID')}`;
                }
            }

            // Hitung sisa bayar reguler
            function calculateRemaining() {
                const amountInput = document.getElementById('amount_paid');
                const dpInput = document.getElementById('dp_amount');
                const remainingInput = document.getElementById('remaining_amount');
                
                if (amountInput && dpInput && remainingInput) {
                    const totalPrice = parseFloat(amountInput.value.replace(/[^0-9]/g, '')) || 0;
                    const dpAmount = parseFloat(dpInput.value) || 0;
                    const remaining = totalPrice - dpAmount;
                    remainingInput.value = `Rp ${remaining.toLocaleString('id-ID')}`;
                }
            }

            // Hitung sisa bayar member
            function calculateRemainingMember() {
                const amountInput = document.getElementById('amount_paid_member');
                const dpInput = document.getElementById('dp_amount_member');
                const remainingInput = document.getElementById('remaining_amount_member');
                
                if (amountInput && dpInput && remainingInput) {
                    const totalPrice = parseFloat(amountInput.value.replace(/[^0-9]/g, '')) || 0;
                    const dpAmount = parseFloat(dpInput.value) || 0;
                    const remaining = totalPrice - dpAmount;
                    remainingInput.value = `Rp ${remaining.toLocaleString('id-ID')}`;
                }
            }

            // Hitung jam mingguan member
            function calculateWeeklyHours() {
                const totalHours = parseFloat(document.getElementById('total_hours')?.value) || 0;
                maxWeeklyHours = totalHours / 4;
                const weeklySpan = document.getElementById('weekly_hours');
                if (weeklySpan) weeklySpan.textContent = maxWeeklyHours.toFixed(2);
            }
            
            // Validasi waktu member
            function validateMemberSchedule() {
                // Implementasi validasi member jika diperlukan
            }

            // === EVENT LISTENERS ===
            
            // Toggle booking type
            const bookingType = document.getElementById('booking_type');
            if (bookingType) {
                bookingType.addEventListener('change', toggleBookingType);
            }

            // Regular booking events
            const startTime = document.getElementById('start_time');
            const duration = document.getElementById('duration');
            const endTime = document.getElementById('end_time');
            const dpAmount = document.getElementById('dp_amount');
            const dpAmountMember = document.getElementById('dp_amount_member');
            const totalHours = document.getElementById('total_hours');

            if (startTime) {
                startTime.addEventListener('change', function() {
                    calculateEndTime();
                    calculateTotalPrice();
                    updateDurationOptions();
                });
                startTime.min = '07:00';
                startTime.max = '22:00';
                startTime.step = '3600';
            }

            if (duration) {
                duration.addEventListener('change', function() {
                    calculateEndTime();
                    calculateTotalPrice();
                });
            }

            if (dpAmount) {
                dpAmount.addEventListener('input', calculateRemaining);
            }

            if (dpAmountMember) {
                dpAmountMember.addEventListener('input', calculateRemainingMember);
            }

            if (totalHours) {
                totalHours.addEventListener('input', function() {
                    calculateWeeklyHours();
                    calculateMemberPrice();
                });
            }

            // Checkbox hari member
            document.querySelectorAll('.day-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function () {
                    const timeRange = this.closest('.form-check')?.querySelector('.time-range');
                    if (timeRange) {
                        timeRange.style.display = this.checked ? 'block' : 'none';
                    }
                });
            });

            // Form submit
            const form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', function (e) {
                    // Tambahkan schedule details untuk member
                    const scheduleDetails = {};
                    document.querySelectorAll('.day-checkbox:checked').forEach(day => {
                        const dayName = day.value;
                        const startInput = day.closest('.form-check')?.querySelector('input[placeholder="Waktu Mulai"]');
                        const endInput = day.closest('.form-check')?.querySelector('input[placeholder="Waktu Selesai"]');
                        
                        if (startInput?.value && endInput?.value) {
                            scheduleDetails[dayName] = {
                                start: startInput.value,
                                end: endInput.value,
                            };
                        }
                    });
                    
                    const scheduleInput = document.createElement('input');
                    scheduleInput.type = 'hidden';
                    scheduleInput.name = 'schedule_details';
                    scheduleInput.value = JSON.stringify(scheduleDetails);
                    this.appendChild(scheduleInput);
                });
            }

            // Date form
            const dateForm = document.getElementById('date-form');
            if (dateForm) {
                dateForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    const date = document.getElementById('date')?.value;
                    if (date) {
                        fetch('/get-jadwal?date=' + date)
                            .then(response => response.text())
                            .then(html => {
                                const container = document.getElementById('jadwal-container');
                                if (container) container.innerHTML = html;
                            });
                    }
                });
            }

            // === INISIALISASI ===
            
            // Set default duration jika ada start time
            setTimeout(function() {
                if (startTime?.value && duration && !duration.value) {
                    duration.value = '1';
                    calculateEndTime();
                    calculateTotalPrice();
                }
            }, 100);

            // Inisialisasi toggle booking type
            toggleBookingType();
        });
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const startTimeInput = document.getElementById('start_time');
            const pesanSekarangButton = document.getElementById('pesanSekarang'); // atau sesuaikan ID tombolnya
            
            if (startTimeInput) {
                // Set atribut batasan
                startTimeInput.min = '07:00';
                startTimeInput.max = '23:00';
            }
            
            // Validasi saat tombol pesan sekarang diklik
            if (pesanSekarangButton && startTimeInput) {
                pesanSekarangButton.addEventListener('click', function(e) {
                    const timeValue = startTimeInput.value;
                    
                    if (!timeValue) {
                        e.preventDefault();
                        alert('Harap pilih waktu mulai');
                        startTimeInput.focus();
                        return false;
                    }
                    
                    const [hours] = timeValue.split(':').map(Number);
                    if (hours < 7 || hours > 23) {
                        e.preventDefault();
                        alert('Waktu harus antara 07:00-23:00');
                        startTimeInput.focus();
                        return false;
                    }
                });
            }
            
        });

    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const totalHoursInput = document.getElementById('total_hours');
            const weeklyHoursSpan = document.getElementById('weekly_hours');
            const checkboxes = document.querySelectorAll('.day-checkbox');
            let maxWeeklyHours = 0;

            // Fungsi untuk menghitung jam mingguan berdasarkan total jam bulanan
            function calculateWeeklyHours() {
                const totalHours = parseFloat(totalHoursInput.value) || 0;
                maxWeeklyHours = totalHours / 4; // 4 minggu per bulan
                weeklyHoursSpan.textContent = maxWeeklyHours.toFixed(2);
                
                // Reset pesan error
                hapusSemuaPesanError();
                updateAllTimeConstraints();
            }

            // Fungsi untuk menghitung total jam mingguan saat ini
            function getCurrentWeeklyHours() {
                let totalMinutes = 0;

                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const day = checkbox.value;
                        const timeRangeDiv = checkbox.closest('.form-check').querySelector('.time-range');
                        const startInput = timeRangeDiv.querySelector('input[name$="[start]"]');
                        const endInput = timeRangeDiv.querySelector('input[name$="[end]"]');

                        const start = startInput.value;
                        const end = endInput.value;

                        if (start && end) {
                            const [startHour] = start.split(':').map(Number);
                            const [endHour] = end.split(':').map(Number);

                            if (endHour > startHour) {
                                totalMinutes += (endHour - startHour) * 60;
                            }
                        }
                    }
                });

                return totalMinutes / 60;
            }

            // Fungsi untuk menampilkan pesan error
            function showErrorMessage(element, message) {
                // Hapus error message sebelumnya
                hapusPesanError(element);
                
                const errorDiv = document.createElement('div');
                errorDiv.className = 'text-danger error-message';
                errorDiv.textContent = message;
                errorDiv.style.fontSize = '0.875em';
                element.parentNode.appendChild(errorDiv);
            }

            // Fungsi untuk menghapus pesan error
            function hapusPesanError(element) {
                const existingError = element.parentNode.querySelector('.error-message');
                if (existingError) {
                    existingError.remove();
                }
            }

            // Fungsi untuk menghapus semua pesan error
            function hapusSemuaPesanError() {
                document.querySelectorAll('.error-message').forEach(el => el.remove());
            }

            // Fungsi untuk memperbarui batasan waktu untuk semua input
            function updateAllTimeConstraints() {
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const timeRangeDiv = checkbox.closest('.form-check').querySelector('.time-range');
                        const startInput = timeRangeDiv.querySelector('input[name$="[start]"]');
                        const endInput = timeRangeDiv.querySelector('input[name$="[end]"]');
                        
                        if (startInput && endInput) {
                            updateEndTimeConstraint(startInput, endInput);
                        }
                    }
                });
            }

            // Fungsi untuk memperbarui batasan waktu selesai
            function updateEndTimeConstraint(startInput, endInput) {
                const start = startInput.value;
                if (start && maxWeeklyHours > 0) {
                    const [startHour] = start.split(':').map(Number);
                    const maxEndHour = Math.min(23, startHour + Math.floor(maxWeeklyHours));
                    
                    endInput.min = start;
                    endInput.max = `${String(maxEndHour).padStart(2, '0')}:00`;
                }
            }

            // Fungsi untuk memvalidasi apakah total jam tidak melebihi batas
            function validateWeeklyHours() {
                const currentHours = getCurrentWeeklyHours();
                if (currentHours > maxWeeklyHours) {
                    return false;
                }
                return true;
            }

            // Event listener untuk total jam bulanan
            totalHoursInput.addEventListener('input', calculateWeeklyHours);

            // Setup event listener untuk setiap checkbox hari
            checkboxes.forEach(checkbox => {
                const day = checkbox.value;
                const timeRangeDiv = checkbox.closest('.form-check').querySelector('.time-range');
                const startInput = timeRangeDiv ? timeRangeDiv.querySelector('input[name$="[start]"]') : null;
                const endInput = timeRangeDiv ? timeRangeDiv.querySelector('input[name$="[end]"]') : null;

                // Toggle waktu input saat checkbox di klik
                checkbox.addEventListener('change', function () {
                    if (timeRangeDiv) {
                        timeRangeDiv.style.display = this.checked ? 'block' : 'none';
                        if (!this.checked) {
                            if (startInput) {
                                startInput.value = '';
                                hapusPesanError(startInput);
                            }
                            if (endInput) {
                                endInput.value = '';
                                hapusPesanError(endInput);
                            }
                        }
                    }
                });

                // Batasi waktu selesai berdasarkan waktu mulai dan batas mingguan
                if (startInput) {
                    startInput.addEventListener('change', function () {
                        if (endInput) {
                            updateEndTimeConstraint(this, endInput);
                            hapusPesanError(this);
                        }
                    });
                }

                // Validasi saat waktu selesai berubah
                if (endInput) {
                    endInput.addEventListener('change', function() {
                        const startInput = this.closest('.time-range').querySelector('input[name$="[start]"]');
                        const start = startInput.value;
                        const end = this.value;
                        
                        if (start && end) {
                            const [startHour] = start.split(':').map(Number);
                            const [endHour] = end.split(':').map(Number);
                            
                            if (endHour <= startHour) {
                                showErrorMessage(this, 'Waktu selesai harus lebih besar dari waktu mulai');
                                return;
                            }
                            
                            // Hitung jam untuk sesi ini
                            const sessionHours = endHour - startHour;
                            
                            // Hitung total jam mingguan tanpa sesi ini
                            const currentHours = getCurrentWeeklyHours();
                            const hoursWithoutThisSession = currentHours - sessionHours;
                            
                            // Hitung sisa jam yang bisa digunakan
                            const remainingHours = maxWeeklyHours - hoursWithoutThisSession;
                            
                            if (sessionHours > remainingHours) {
                                showErrorMessage(this, `Waktu sewa anda melebihi batas maksimal mingguan`);
                            } else {
                                hapusPesanError(this);
                            }
                            
                        }
                    });
                }
            });

            // Inisialisasi batasan waktu awal
            document.querySelectorAll('input[type="time"]').forEach(input => {
                input.min = '07:00';
                input.max = '23:00';
            });
        });
    </script>


{{-- <script>
        // Variabel global
        let currentBookingId = null;

        // Event listener untuk form submit
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Submit form via AJAX
            const formData = new FormData(this);
            
            fetch('{{ route('bookings.store') }}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content'),
                    'X-Requested-With': 'XMLHttpRequest' // Penting untuk deteksi AJAX
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.booking) {
                    // Jika booking berhasil dibuat dan ada DP, lanjutkan ke pembayaran
                    if (data.booking.dp_amount > 0) {
                        initiatePayment(data.booking);
                    }
                } else {
                    alert(data.message || 'Terjadi kesalahan saat membuat booking');
                    // Redirect juga jika perlu
                    if (data.redirect_url) {
                        window.location.href = data.redirect_url;
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat memproses booking');
            });
        });

        // Inisiasi pembayaran
        function initiatePayment(booking) {
            // Buat pembayaran Midtrans
            console.log('test');
            
            fetch('{{ route('payment.create') }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({
                    booking_id: booking.id
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.snap_token) {
                    // Trigger Snap popup
                    snap.pay(data.snap_token, {
                        onSuccess: function(result) {
                            console.log('Payment success:', result);
                            alert('Pembayaran berhasil!');
                            window.location.href = '{{ route('book') }}';
                        },
                        onPending: function(result) {
                            console.log('Payment pending:', result);
                            alert('Pembayaran sedang diproses');
                            window.location.href = '{{ route('book') }}';
                        },
                        onError: function(result) {
                            console.log('Payment error:', result);
                            alert('Pembayaran gagal: ' + (result.status_message || ''));
                        }
                    });
                } else {
                    alert('Gagal membuat pembayaran: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat memproses pembayaran');
            });
        }
    </script> --}}
    {{-- <script>
        // Variabel global
        let currentBookingId = null;

        // Event listener untuk form submit
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validasi form dulu
            if (!validateForm()) {
                return;
            }
            
            // Submit form via AJAX
            const formData = new FormData(this);
            
            fetch('{{ route('bookings.store') }}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Jika booking berhasil dibuat, lanjutkan ke pembayaran
                    if (data.booking && data.booking.dp_amount > 0) {
                        currentBookingId = data.booking.id;
                        showPaymentModal(data.booking.dp_amount);
                    } else {
                        // Jika tidak perlu bayar DP, redirect langsung
                        window.location.href = data.redirect_url || '{{ route('book') }}';
                    }
                } else {
                    alert('Error: ' + (data.message || 'Terjadi kesalahan saat membuat booking'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat memproses booking');
            });
        });

        // Tampilkan modal pembayaran
        function showPaymentModal(amount) {
            const formattedAmount = new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR'
            }).format(amount);
            
            document.getElementById('paymentAmount').textContent = formattedAmount;
            
            const modal = new bootstrap.Modal(document.getElementById('paymentModal'));
            modal.show();
        }

        // Event listener untuk tombol bayar Midtrans
        document.getElementById('payWithMidtrans').addEventListener('click', function() {
            if (!currentBookingId) {
                alert('Booking ID tidak ditemukan');
                return;
            }
            
            // Buat pembayaran Midtrans
            fetch('{{ route('payment.create') }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({
                    booking_id: currentBookingId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.snap_token) {
                    // Trigger Snap popup
                    snap.pay(data.snap_token, {
                        onSuccess: function(result) {
                            console.log('Payment success:', result);
                            alert('Pembayaran berhasil!');
                            window.location.href = '{{ route('book') }}';
                        },
                        onPending: function(result) {
                            console.log('Payment pending:', result);
                            alert('Pembayaran sedang diproses');
                            window.location.href = '{{ route('book') }}';
                        },
                        onError: function(result) {
                            console.log('Payment error:', result);
                            alert('Pembayaran gagal');
                        }
                    });
                } else {
                    alert('Gagal membuat pembayaran: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat memproses pembayaran');
            });
        });
    </script> --}}

    {{-- <script>
        function payWithMidtrans(bookingId) {
            fetch('/payment/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
                },
                body: JSON.stringify({
                    booking_id: bookingId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.snap_token) {
                    // Trigger Snap popup
                    snap.pay(data.snap_token, {
                        onSuccess: function(result) {
                            console.log('Payment success:', result);
                            window.location.href = '/payment/success';
                        },
                        onPending: function(result) {
                            console.log('Payment pending:', result);
                            window.location.href = '/payment/unfinish';
                        },
                        onError: function(result) {
                            console.log('Payment error:', result);
                            window.location.href = '/payment/error';
                        }
                    });
                } else {
                    alert('Gagal membuat pembayaran: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat memproses pembayaran');
            });
        }
    </script> --}}